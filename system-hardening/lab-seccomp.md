# Lab - Seccomp



{% hint style="info" %}
Which syscall is `NOT` made by the command `ls /root`?

Try it out for yourself using strace.

\===============

Run: `strace -c ls /root` and inspect the summary. The `ls` command should not be using the `connect` syscall.
{% endhint %}



{% hint style="info" %}
For answering the next question, open a new terminal on the `controlplane` node by clicking on the `+` button next to `Terminal 1`.

Next, on this new terminal, stream the logs using below command:

```
kubectl logs -f -n tracee `kubectl get -n tracee pods -l app.kubernetes.io/name=tracee -o custom-columns=":metadata.name" --no-headers`
```

In the `tracee` namespace, we deploy `tracee` as a DaemonSet in our Kubernetes cluster with the appropriate flags to enable real-time monitoring of syscalls originating from the new containers.
{% endhint %}



{% hint style="info" %}
We have just scheduled a new pod. What is the command run by the container inside this pod?

Inspect the pod called `hello`

`======`

Run: `kubectl describe pod hello` and look at the command/args run inside the container.
{% endhint %}



{% hint style="info" %}
Observe the output captured by the tracee container.

Which was the last syscall that was generated by the container that ran the message `echo hello`?

\============



Run the following command to get the last syscall generated from the `hello` container:

```
kubectl logs -n tracee -l app.kubernetes.io/name=tracee | grep hello | grep syscall | tail -n1
```
{% endhint %}



{% hint style="info" %}
A seccomp profile file called `custom-profile.json` has been placed under `/root` directory.

What type of a profile is this?

\======================

This profile has the default action of `SCMP_ACT_ERRNO` that blocks all syscalls by default. The syscalls to be allowed are part of the `whitelist`. This is an example of a `whitelist` type profile.
{% endhint %}



{% hint style="info" %}
Create a new pod called `audit-nginx` using the `nginx` image and make use of the `audit.json` seccomp profile in the `pod's` security context.

\


The `audit.json` file is already present in the default seccomp profile path in the `controlplane` node.

\==============

In the Pod spec, make use of the `seccompProfile` field under `securityContext`. Use the correct profile as specified in the question.

\===============

Use the following YAML file to create the pod:

```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: nginx
  name: audit-nginx
spec:
  securityContext:
    seccompProfile:
      type: Localhost
      localhostProfile: profiles/audit.json
  containers:
  - image: nginx
    name: nginx
```

Open a text editor and use the above YAML and save it to a file such as `audit-nginx.yaml`. Next, create the pod by running: `kubectl create -f audit-nginx.yaml`.
{% endhint %}
