# AquaSec Tracee

<figure><img src="../.gitbook/assets/image (9) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* In this lecture, let's take a look at Tracee, a tool from Aqua Security, which can be used to trace syscalls on a container. Tracee is an open-source tool created by Aqua Security that makes use of eBPF to trace the system at runtime. eBPF stands for Extended Berkeley Packet Filter that can run programs directly in the kernel space without interfering with the kernel source code or loading any kernel modules.
* As a result, eBPF programs are used to create tools such as the Aqua Security Tracee that can monitor the OS and detect suspicious behavior. You could easily install Tracey directly on the server and run it. However, instead of going through the hassle of installing the dependencies and finding the right binary for your server, an easier alternative is to run Tracee as a docker container.
* We will see that in a minute. However, there are a couple of prerequisites that must be understood before we start. As mentioned earlier, Tracee uses an eBPF technology, and when run as a docker container, it builds the eBPF program and stores it at /tmp/Tracee directory by default. To make sure that this program can be built once and used for successive runs, we can bind mount the directory /tmp/Tracee from the host to the container.
* Secondly, in order to compile this eBPF program, Tracee needs access to kernel headers, which an ubuntu under /lip/modules and its dependencies under /usr/src.
* Hence we need to bind mount these directories as well on the container in read-only mode.
* Finally, for tracing syscalls, Tracee needs additional capabilities on the host. Using the --privileged flag on docker is an easy way to get started.
* Now that we have understood the basics of how Tracee works, let us put it to use.

<figure><img src="../.gitbook/assets/image (10) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* There are several ways in which Tracee can capture syscalls. To observe the syscalls generated by a single command, such as LS from the container with the options that we just discussed like this. Here we are making use of the --trace command with the value of command is equal to LS.
* You should see an output like this with all these syscalls invoked by the LS command.

<figure><img src="../.gitbook/assets/image (11) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* Similarly, to observe the syscalls for all new processes on the host, run the container like this. Here we are running the container with the --trace flag with the value of PID is equal to new. Please know that this will generate a lot of output based on the syscalls that are generated by all the new processes on the host.

<figure><img src="../.gitbook/assets/image (12) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* We can also observe the syscalls generated by a new container. To do this, on the same command as before but with the flag container is equal to new. On a separate terminal window, let us now run an ubuntu container that just prints the word "hi" and exits.&#x20;
* Now, switching back to the terminal where we are running the Tracee container, we can see all these syscalls run by the new ubuntu container.
